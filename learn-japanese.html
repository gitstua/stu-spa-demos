<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japanese Learning Cards</title>
    <style>
        :root {
            --primary-color: #4a86e8;
            --secondary-color: #f9f9f9;
            --text-color: #333;
            --card-width: 400px;
        }
        
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            width: 100%;
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .container {
            width: 100%;
            max-width: var(--card-width);
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .card {
            width: 100%;
            height: 250px;
            perspective: 1000px;
            margin-bottom: 20px;
            cursor: pointer;
        }
        
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            border-radius: 10px;
        }
        
        .card-front {
            background-color: white;
        }
        
        .card-back {
            background-color: var(--secondary-color);
            transform: rotateY(180deg);
        }
        
        .japanese-text {
            font-size: 24px;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        
        .romaji {
            font-size: 18px;
            color: #666;
            margin-bottom: 15px;
        }
        
        .english-text {
            font-size: 22px;
            color: var(--primary-color);
        }
        
        .tags {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .tag {
            background-color: #e0e0ff;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin: 3px;
        }
        
        .controls {
            width: 100%;
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #3a76d8;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .audio-button {
            background-color: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            margin-top: 10px;
            display: flex;
            align-items: center;
        }
        
        .audio-button svg {
            margin-right: 5px;
        }
        
        .card-count {
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            width: 100%;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            color: red;
            text-align: center;
            padding: 20px;
        }
        
        .back-to-home {
            position: absolute;
            top: 10px;
            left: 10px;
            text-decoration: none;
            color: var(--primary-color);
            font-size: 14px;
            display: flex;
            align-items: center;
        }
        
        .back-to-home svg {
            margin-right: 5px;
        }
        
        .app-info {
            margin-top: 40px;
            text-align: center;
            font-size: 14px;
            color: #666;
            max-width: 600px;
        }
        
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px;
            text-align: center;
            font-size: 12px;
            color: #666;
            border-top: 1px solid #eee;
        }
    </style>
</head>
<body>
    <a href="/" class="back-to-home">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.5 7.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/>
        </svg>
        Back to Home
    </a>
    
    <header>
        <h1>日本語 Flash Cards</h1>
        <p>Click on cards to reveal the meaning. Audio plays automatically.</p>
    </header>
    
    <div class="container">
        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
        </div>
        
        <div id="error" class="error" style="display: none;"></div>
        
        <div id="card-container" class="card" style="display: none;">
            <div class="card-inner">
                <div class="card-front">
                    <div class="japanese-text" id="front-japanese"></div>
                    <div class="romaji" id="front-romaji"></div>
                    <button class="audio-button" id="front-audio">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"/>
                            <path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z"/>
                            <path d="M8.707 11.182A4.486 4.486 0 0 0 10.025 8a4.486 4.486 0 0 0-1.318-3.182L8 5.525A3.489 3.489 0 0 1 9.025 8 3.49 3.49 0 0 1 8 10.475l.707.707zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z"/>
                        </svg>
                        Play Audio
                    </button>
                </div>
                <div class="card-back">
                    <div class="english-text" id="back-english"></div>
                    <div class="tags" id="back-tags"></div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button id="prev-button" disabled>Previous</button>
            <button id="next-button" disabled>Next</button>
        </div>
        
        <div class="card-count" id="card-count"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let cards = [];
            let currentCardIndex = 0;
            let audio = new Audio();
            
            // Get elements
            const cardContainer = document.getElementById('card-container');
            const cardElement = document.querySelector('.card');
            const frontJapanese = document.getElementById('front-japanese');
            const frontRomaji = document.getElementById('front-romaji');
            const frontAudio = document.getElementById('front-audio');
            const backEnglish = document.getElementById('back-english');
            const backTags = document.getElementById('back-tags');
            const prevButton = document.getElementById('prev-button');
            const nextButton = document.getElementById('next-button');
            const cardCount = document.getElementById('card-count');
            const loading = document.getElementById('loading');
            const errorElement = document.getElementById('error');
            
            // Fisher-Yates shuffle algorithm
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            // Function to parse CSV
            async function fetchCardData() {
                try {
                    const response = await fetch('japanese/words.csv');
                    if (!response.ok) {
                        throw new Error('Failed to load words.csv');
                    }
                    const data = await response.text();
                    return parseCSV(data);
                } catch (error) {
                    console.error('Error fetching card data:', error);
                    errorElement.textContent = 'Failed to load card data. Please try refreshing the page.';
                    errorElement.style.display = 'block';
                    loading.style.display = 'none';
                    return [];
                }
            }
            
            function parseCSV(csv) {
                const lines = csv.split('\n');
                const result = [];
                
                // Start from index 1 to skip header line
                for (let i = 1; i < lines.length; i++) {
                    // Skip empty lines
                    if (!lines[i].trim()) continue;
                    
                    // Basic CSV parsing with quote handling
                    const values = [];
                    let currentValue = '';
                    let insideQuotes = false;
                    
                    for (let char of lines[i]) {
                        if (char === '"') {
                            insideQuotes = !insideQuotes;
                        } else if (char === ',' && !insideQuotes) {
                            values.push(currentValue);
                            currentValue = '';
                        } else {
                            currentValue += char;
                        }
                    }
                    
                    // Push the last value
                    values.push(currentValue);
                    
                    if (values.length >= 3) {
                        // Parse the front of the card
                        const frontText = values[0];
                        
                        // Extract audio filename and text content
                        const audioMatch = frontText.match(/\[sound:(.*?)\]/);
                        const audioFile = audioMatch ? audioMatch[1] : null;
                        
                        // Split the remaining text into romaji and Japanese
                        let textContent = frontText.replace(/\[sound:.*?\]\s*/, '').trim();
                        let romaji = '';
                        let japanese = '';
                        
                        // If there's a space, assume format is "romaji japanese"
                        const lastSpaceIndex = textContent.lastIndexOf(' ');
                        if (lastSpaceIndex !== -1) {
                            romaji = textContent.substring(0, lastSpaceIndex).trim();
                            japanese = textContent.substring(lastSpaceIndex + 1).trim();
                        } else {
                            // If no space, it's all Japanese
                            japanese = textContent;
                        }
                        
                        // Parse the back of the card
                        const english = values[1];
                        
                        // Parse tags
                        const tags = values[2].split(',').map(tag => tag.trim());
                        
                        result.push({
                            audioFile,
                            romaji,
                            japanese,
                            english,
                            tags
                        });
                    }
                }
                
                return result;
            }
            
            function displayCard(index) {
                const card = cards[index];
                
                // Update front of card
                frontJapanese.textContent = card.japanese;
                frontRomaji.textContent = card.romaji;
                
                // Update back of card
                backEnglish.textContent = card.english;
                
                // Clear and update tags
                backTags.innerHTML = '';
                card.tags.forEach(tag => {
                    if (tag) {
                        const tagElement = document.createElement('span');
                        tagElement.classList.add('tag');
                        tagElement.textContent = tag;
                        backTags.appendChild(tagElement);
                    }
                });
                
                // Update card count
                cardCount.textContent = `Card ${index + 1} of ${cards.length}`;
                
                // Auto-play audio if available
                if (card.audioFile) {
                    audio.src = `japanese/audio_files/${card.audioFile}`;
                    // Small delay to ensure UI updates first
                    setTimeout(() => {
                        audio.play().catch(err => {
                            console.log('Auto-play prevented:', err);
                        });
                    }, 300);
                }
                
                // Update audio button click handler
                frontAudio.onclick = () => {
                    if (card.audioFile) {
                        audio.src = `japanese/audio_files/${card.audioFile}`;
                        audio.play();
                    }
                };
                
                // Enable/disable navigation buttons
                prevButton.disabled = index === 0;
                nextButton.disabled = index === cards.length - 1;
                
                // Make sure card is not flipped when changing cards
                cardElement.classList.remove('flipped');
            }
            
            // Initialize
            async function init() {
                cards = await fetchCardData();
                
                if (cards.length > 0) {
                    // Shuffle cards
                    cards = shuffleArray(cards);
                    
                    loading.style.display = 'none';
                    cardContainer.style.display = 'block';
                    displayCard(currentCardIndex);
                    
                    // Setup event listeners
                    cardContainer.addEventListener('click', (e) => {
                        // Don't flip the card if clicking the audio button
                        if (e.target.closest('.audio-button')) return;
                        cardElement.classList.toggle('flipped');
                    });
                    
                    prevButton.addEventListener('click', () => {
                        if (currentCardIndex > 0) {
                            currentCardIndex--;
                            displayCard(currentCardIndex);
                        }
                    });
                    
                    nextButton.addEventListener('click', () => {
                        if (currentCardIndex < cards.length - 1) {
                            currentCardIndex++;
                            displayCard(currentCardIndex);
                        }
                    });
                    
                    // Add keyboard navigation
                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'ArrowLeft' && currentCardIndex > 0) {
                            currentCardIndex--;
                            displayCard(currentCardIndex);
                        } else if (e.key === 'ArrowRight' && currentCardIndex < cards.length - 1) {
                            currentCardIndex++;
                            displayCard(currentCardIndex);
                        } else if (e.key === ' ' || e.key === 'Enter') {
                            cardElement.classList.toggle('flipped');
                        } else if (e.key === 'a') {
                            // Play audio with 'a' key
                            frontAudio.click();
                        }
                    });
                    
                    // Save current state in URL fragment
                    function updateUrlFragment() {
                        window.location.hash = `card=${currentCardIndex}`;
                    }
                    
                    // Check if there's a card index in the URL fragment
                    const hashMatch = window.location.hash.match(/card=(\d+)/);
                    if (hashMatch && hashMatch[1]) {
                        const savedIndex = parseInt(hashMatch[1], 10);
                        if (savedIndex >= 0 && savedIndex < cards.length) {
                            currentCardIndex = savedIndex;
                            displayCard(currentCardIndex);
                        }
                    }
                    
                    // Update URL when changing cards
                    prevButton.addEventListener('click', updateUrlFragment);
                    nextButton.addEventListener('click', updateUrlFragment);
                    
                    // Add audio playback on card display
                    audio.addEventListener('ended', () => {
                        console.log('Audio playback completed');
                    });
                }
            }
            
            init();
        });
    </script>
    
    <div class="app-info">
        <p>This is a Japanese language learning application that displays flash cards with Japanese text, romaji, and English translations. 
        It features audio pronunciation and randomized card order to help users learn Japanese vocabulary more effectively.</p>
    </div>
    
    <div class="footer">
        Made with ❤️ by Stu at github.com/gitstua/stu-spa-demos using GitHub Copilot | Version 1.0
    </div>
</body>
</html>
